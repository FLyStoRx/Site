<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>COPYFLIX</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="icon" type="image/png" href="favicon.png">
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
<script src="https://unpkg.com/lucide@latest"></script>

<style>
:root {
  --primary: #dc2626;
  --bg: #000000;
  --surface: #0a0a0a;
  --text-muted: #a3a3a3;
  --transition: all 0.6s cubic-bezier(0.16, 1, 0.3, 1);
  --radius: 14px;
}

* { margin:0; padding:0; box-sizing:border-box; font-family: 'Plus Jakarta Sans', sans-serif; }

::-webkit-scrollbar { width: 8px; }
::-webkit-scrollbar-track { background: var(--bg); }
::-webkit-scrollbar-thumb { background: #262626; border-radius: 10px; }

body { background: var(--bg); color: #fff; overflow-x: hidden; min-height: 100vh; }
body.no-scroll { overflow: hidden; }

#app-content { transition: filter 0.5s ease, transform 0.5s ease; }
body.player-open #app-content { filter: blur(15px) brightness(0.5); transform: scale(0.98); }

/* HEADER */
header {
  position: fixed; top: 0; width: 100%; height: 80px; z-index: 1000;
  display: flex; align-items: center; justify-content: space-between;
  padding: 0 5%; transition: var(--transition);
}
header.scrolled {
  background: rgba(0, 0, 0, 0.85); backdrop-filter: blur(25px);
  height: 65px; border-bottom: 1px solid rgba(255, 255, 255, 0.05);
}

.logo { font-size: 26px; font-weight: 800; cursor: pointer; text-transform: uppercase; }
.logo span { color: var(--primary); }

.nav-right { display: flex; align-items: center; gap: 20px; }
.search-wrapper {
  background: #111; border-radius: 12px; padding: 10px 18px;
  display: flex; align-items: center; gap: 12px;
  border: 1px solid rgba(255,255,255,0.05); transition: var(--transition);
  position: relative;
}
.search-wrapper input { background: transparent; border: none; color: white; outline: none; width: 160px; }
#clear-search { cursor: pointer; color: var(--text-muted); font-size: 0.9rem; display: none; }

.admin-trigger {
  width: 42px; height: 42px; border-radius: 12px;
  background: var(--primary); color: white; border: none;
  cursor: pointer; display: flex; align-items: center; justify-content: center;
}

/* HERO SECTION */
.hero-minimal { 
  padding-top: 120px; 
  text-align: center; 
  margin-bottom: 40px; 
  display: flex; 
  flex-direction: column; 
  align-items: center;
}

/* CATEGORIES FILTER */
.category-filter-wrapper { margin: 20px auto 30px; display: flex; justify-content: center; gap: 12px; flex-wrap: wrap; padding: 0 5%; }

.cat-btn { 
  display: flex; align-items: center; gap: 8px;
  background: rgba(255, 255, 255, 0.05); 
  backdrop-filter: blur(15px); 
  border: 1px solid rgba(255, 255, 255, 0.15); 
  color: #fff; padding: 8px 18px; border-radius: 10px; 
  font-size: 0.75rem; font-weight: 800; text-transform: uppercase;
  cursor: pointer; transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1); 
  box-shadow: 0 4px 15px rgba(0,0,0,0.3);
}

.cat-btn i { width: 14px; height: 14px; opacity: 0.7; }
.cat-btn:hover { background: rgba(255, 255, 255, 0.1); transform: translateY(-2px); }

.cat-btn[data-cat="all"].active { background: #fff; color: #000; border-color: #fff; }
.cat-btn[data-cat="Action"].active { background: rgba(220, 38, 38, 0.5); border-color: #dc2626; }
.cat-btn[data-cat="Comédie"].active { background: rgba(234, 179, 8, 0.5); border-color: #eab308; }
.cat-btn[data-cat="Horreur"].active { background: rgba(255, 255, 255, 0.2); border-color: #fff; }
.cat-btn[data-cat="SF"].active { background: rgba(37, 99, 235, 0.5); border-color: #2563eb; }
.cat-btn[data-cat="Animation"].active { background: rgba(22, 163, 74, 0.5); border-color: #16a34a; }
.cat-btn[data-cat="Docu"].active { background: rgba(147, 51, 234, 0.5); border-color: #9333ea; }

.tab-nav { background: #111; padding: 6px; border-radius: 16px; display: inline-flex; margin-bottom: 10px;}
.tab-nav button { padding: 10px 25px; border-radius: 10px; border: none; background: transparent; color: var(--text-muted); font-weight: 600; cursor: pointer; transition: var(--transition); }
.tab-nav button.active { background: #fff; color: #000; }

/* NAV CONTROLS */
.nav-controls { max-width: 1700px; margin: 0 auto; padding: 0 5% 30px; display: flex; align-items: center; gap: 15px; }
#back-arrow { display: none; width: 48px; height: 48px; border-radius: 14px; background: #111; border: 1px solid #222; color: white; align-items: center; justify-content: center; cursor: pointer; transition: var(--transition); }
#breadcrumb-nav { display: none; align-items: center; gap: 10px; font-weight: 600; }
.bc-item:last-child { color: var(--primary); }

/* GRID & CARDS */
#main-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 35px; padding: 0 5% 100px; max-width: 1700px; margin: 0 auto; }
.content-card { cursor: pointer; transition: var(--transition); opacity: 0; transform: translateY(20px); display: flex; flex-direction: column; gap: 12px; text-align: center; }
.content-card.visible { opacity: 1; transform: translateY(0); }

.poster-wrapper { position: relative; aspect-ratio: 2/3.1; border-radius: var(--radius); overflow: hidden; background: #0a0a0a; border: 1px solid rgba(255,255,255,0.05); transition: var(--transition); }
.poster-wrapper img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.8s ease; }
.content-card:hover .poster-wrapper img { transform: scale(1.08); }

/* BADGES AVEC LUEUR */
.category-badge { 
  position: absolute; top: 12px; right: 12px; z-index: 5; 
  display: flex; align-items: center; gap: 6px; padding: 6px 12px; 
  border-radius: 10px; backdrop-filter: blur(15px); border: 1px solid rgba(255,255,255,0.2); 
  font-size: 0.7rem; font-weight: 800; text-transform: uppercase; color: #fff;
  animation: floatBadge 3s ease-in-out infinite;
}

@keyframes floatBadge { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-4px); } }

.badge-Action { background: rgba(220, 38, 38, 0.4); box-shadow: 0 0 15px rgba(220, 38, 38, 0.6); }
.badge-Comédie { background: rgba(234, 179, 8, 0.4); box-shadow: 0 0 15px rgba(234, 179, 8, 0.6); }
.badge-Horreur { background: rgba(255, 255, 255, 0.15); box-shadow: 0 0 15px rgba(255, 255, 255, 0.3); }
.badge-SF { background: rgba(37, 99, 235, 0.4); box-shadow: 0 0 15px rgba(37, 99, 235, 0.6); }
.badge-Animation { background: rgba(22, 163, 74, 0.4); box-shadow: 0 0 15px rgba(22, 163, 74, 0.6); }
.badge-Docu { background: rgba(147, 51, 234, 0.4); box-shadow: 0 0 15px rgba(147, 51, 234, 0.6); }

.content-title { font-size: 1rem; font-weight: 600; color: #eee; }

/* PLAYER */
#player-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.4); z-index: 2000; display: none; opacity: 0; transition: all 0.5s ease; }
#player-overlay.active { opacity: 1; }
#player-hud { position: absolute; inset: 0; z-index: 2100; background: linear-gradient(to bottom, rgba(0,0,0,0.85) 0%, transparent 25%, transparent 75%, rgba(0,0,0,0.85) 100%); opacity: 0; transition: opacity 0.4s ease; display: flex; flex-direction: column; justify-content: space-between; padding: 40px; pointer-events: none; }
#player-overlay:hover #player-hud { opacity: 1; }
.hud-top { display: flex; justify-content: space-between; align-items: flex-start; pointer-events: auto; }
.hud-bottom { display: flex; justify-content: flex-end; pointer-events: auto; padding-bottom: 60px; padding-right: 20px; }

.btn-next-ep { 
  background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.2); 
  padding: 12px 25px; border-radius: 12px; font-weight: 700; cursor: pointer; 
  display: flex; align-items: center; gap: 10px; transition: 0.3s; backdrop-filter: blur(10px);
}
.btn-next-ep:hover { background: var(--primary); border-color: var(--primary); transform: scale(1.05); }

.close-player { width: 50px; height: 50px; background: rgba(255,255,255,0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; backdrop-filter: blur(10px); }
#player-container { width: 100%; height: 100%; }
#player-container iframe { width: 100%; height: 100%; border: none; }
#no-results { display: none; flex-direction: column; align-items: center; padding: 100px 0; color: var(--text-muted); }
</style>
</head>

<body>
<div id="app-content">
  <header id="mainNav">
    <div class="logo" onclick="location.reload()">COPY<span>FLIX</span></div>
    <div class="nav-right">
      <div class="search-wrapper">
        <i class="fa-solid fa-magnifying-glass"></i>
        <input type="text" id="mainSearch" placeholder="Rechercher...">
        <i class="fa-solid fa-xmark" id="clear-search"></i>
      </div>
      <button class="admin-trigger" onclick="window.open('admin/login.html','_blank')"><i class="fa-solid fa-bolt"></i></button>
    </div>
  </header>

  <section class="hero-minimal">
    <div class="tab-nav-wrapper">
      <nav class="tab-nav">
        <button class="active" onclick="filterType('all', this)">Tout</button>
        <button onclick="filterType('film', this)">Films</button>
        <button onclick="filterType('serie', this)">Séries</button>
      </nav>
    </div>

    <div class="category-filter-wrapper">
      <button class="cat-btn active" data-cat="all" onclick="filterCat('all', this)">Tous</button>
      <button class="cat-btn" data-cat="Action" onclick="filterCat('Action', this)"><i data-lucide="zap"></i> Action</button>
      <button class="cat-btn" data-cat="Comédie" onclick="filterCat('Comédie', this)"><i data-lucide="laugh"></i> Comédie</button>
      <button class="cat-btn" data-cat="Horreur" onclick="filterCat('Horreur', this)"><i data-lucide="skull"></i> Horreur</button>
      <button class="cat-btn" data-cat="SF" onclick="filterCat('SF', this)"><i data-lucide="rocket"></i> Science-Fiction</button>
      <button class="cat-btn" data-cat="Animation" onclick="filterCat('Animation', this)"><i data-lucide="palette"></i> Animation</button>
      <button class="cat-btn" data-cat="Docu" onclick="filterCat('Docu', this)"><i data-lucide="globe"></i> Documentaire</button>
    </div>
  </section>

  <div class="nav-controls">
    <div id="back-arrow"><i class="fa-solid fa-arrow-left"></i></div>
    <div id="breadcrumb-nav"></div>
  </div>

  <div id="no-results"><i class="fa-solid fa-ghost" style="font-size:3rem; margin-bottom:20px;"></i><p>Aucun résultat.</p></div>
  <div id="main-grid"></div>
</div>

<div id="player-overlay">
  <div id="player-hud">
    <div class="hud-top">
      <div>
        <div id="hud-parent-name" style="color:var(--primary); font-weight:900; font-size:0.9rem; text-transform:uppercase; letter-spacing:2px;"></div>
        <div id="hud-season-name" style="color:rgba(255,255,255,0.6); font-weight:600; font-size:0.85rem; margin: 4px 0;"></div>
        <h2 id="hud-current-name" style="font-size:1.8rem;"></h2>
      </div>
      <div class="close-player" onclick="closePlayer()"><i class="fa-solid fa-xmark"></i></div>
    </div>
    <div class="hud-bottom">
      <button class="btn-next-ep" id="btn-next-universal" style="display:none;" onclick="handleNextClick()">
        <span id="next-btn-text">SUIVANT</span> <i class="fa-solid fa-forward"></i>
      </button>
    </div>
  </div>
  <div id="player-container"><iframe id="video-engine" allowfullscreen allow="autoplay"></iframe></div>
</div>

<script>
let contentData, currentFilter = 'all', currentCategory = 'all', pathStack = [], currentPlayingItem = null;
const grid = document.getElementById("main-grid");
const breadcrumbNav = document.getElementById("breadcrumb-nav");
const backArrow = document.getElementById("back-arrow");
const searchInput = document.getElementById("mainSearch");
const clearBtn = document.getElementById("clear-search");

const CAT_ICONS = { "Action": "zap", "Comédie": "laugh", "Horreur": "skull", "SF": "rocket", "Animation": "palette", "Docu": "globe" };

window.addEventListener("scroll", () => document.getElementById("mainNav").classList.toggle("scrolled", window.scrollY > 50));

fetch("data.json").then(r => r.json()).then(json => {
  contentData = json;
  renderInitial();
});

function renderInitial() {
  pathStack = [];
  backArrow.style.display = "none";
  breadcrumbNav.style.display = "none";
  displayContent(contentData.folders, contentData.films);
}

function displayContent(folders = [], films = []) {
  grid.innerHTML = "";
  
  const combined = [
    ...folders.map(f => ({...f, isFolder: true})),
    ...films.map(f => ({...f, isFolder: false}))
  ];

  const filtered = combined.filter(item => {
    if (item.active === false) return false;

    if (currentCategory !== 'all' && item.category !== currentCategory) return false;

    if (pathStack.length === 0 && currentFilter !== 'all') {
      const isSoloFilm = (item.type === 'Film');
      const containsFilms = item.isFolder && item.children && item.children.some(child => child.type === 'Film' || (child.video && child.type !== 'Série'));
      const isActuallyFilm = isSoloFilm || containsFilms;

      if (currentFilter === 'film' && !isActuallyFilm) return false;
      if (currentFilter === 'serie' && isActuallyFilm) return false;
    }

    return true;
  });
  
  if(filtered.length === 0) {
    document.getElementById("no-results").style.display = "flex";
  } else {
    document.getElementById("no-results").style.display = "none";
    filtered.forEach(item => buildItem(item));
    lucide.createIcons();
    grid.querySelectorAll(".content-card").forEach((c, i) => setTimeout(() => c.classList.add("visible"), i * 40));
  }
}

function buildItem(item) {
  const card = document.createElement("div");
  card.className = "content-card";
  let badge = "";
  if(item.category && CAT_ICONS[item.category]) {
    badge = `<div class="category-badge badge-${item.category}"><i data-lucide="${CAT_ICONS[item.category]}"></i>${item.category}</div>`;
  }
  card.innerHTML = `<div class="poster-wrapper">${badge}<img src="${item.image}"></div><div class="content-title">${item.title}</div>`;
  
  card.onclick = () => {
    const isSearching = searchInput.value.trim() !== "";
    if (item.video) {
        if (isSearching) { pathStack = []; searchInput.value = ""; clearBtn.style.display = "none"; }
        playMedia(item);
    } else if (item.children && item.children.length > 0) {
        if (isSearching) { pathStack = []; searchInput.value = ""; clearBtn.style.display = "none"; }
        openFolder(item);
    }
  };
  grid.appendChild(card);
}

function openFolder(folder) {
  pathStack.push(folder);
  backArrow.style.display = "flex";
  breadcrumbNav.style.display = "flex";
  breadcrumbNav.innerHTML = pathStack.map(f => `<span class="bc-item">${f.title}</span>`).join(" / ");
  const children = folder.children || [];
  const subFolders = children.filter(c => c.children && c.children.length > 0);
  const mediaFiles = children.filter(c => !c.children || c.video);
  displayContent(subFolders, mediaFiles);
}

backArrow.onclick = () => {
  pathStack.pop();
  if(pathStack.length === 0) renderInitial();
  else {
    const parent = pathStack.pop();
    openFolder(parent);
  }
};

function filterType(t, b) {
  currentFilter = t;
  document.querySelectorAll(".tab-nav button").forEach(btn => btn.classList.remove("active"));
  b.classList.add("active");
  refreshView();
}

function filterCat(c, b) {
  currentCategory = c;
  document.querySelectorAll(".cat-btn").forEach(btn => btn.classList.remove("active"));
  b.classList.add("active");
  refreshView();
}

function refreshView() {
  if(pathStack.length > 0) {
    const currentFolder = pathStack[pathStack.length - 1];
    const children = currentFolder.children || [];
    displayContent(children.filter(c => c.children), children.filter(c => !c.children));
  } else {
    displayContent(contentData.folders, contentData.films);
  }
}

function playMedia(item) {
  currentPlayingItem = item;
  const overlay = document.getElementById("player-overlay");
  const nextBtn = document.getElementById("btn-next-universal");
  const btnText = document.getElementById("next-btn-text");
  const seasonHud = document.getElementById("hud-season-name");
  
  document.getElementById("hud-parent-name").innerText = pathStack.length > 0 ? pathStack[0].title : (item.type || "Film");
  document.getElementById("hud-current-name").innerText = item.title;
  document.getElementById("video-engine").src = item.video;
  
  if (pathStack.length >= 2) {
    seasonHud.innerText = pathStack[pathStack.length - 1].title;
    seasonHud.style.display = "block";
  } else {
    seasonHud.style.display = "none";
  }
  
  nextBtn.style.display = "none"; 

  if (item.type !== "Film" && pathStack.length > 0) {
    const currentSeasonFolder = pathStack[pathStack.length - 1];
    const episodes = currentSeasonFolder.children.filter(c => !c.children || c.video);
    const currentIndex = episodes.findIndex(e => e.title === item.title);

    if (currentIndex < episodes.length - 1) {
      btnText.innerText = "ÉPISODE SUIVANT";
      nextBtn.style.display = "flex";
    } 
    else if (pathStack.length >= 2) {
      const seriesRoot = pathStack[pathStack.length - 2];
      const currentSeasonIndex = seriesRoot.children.findIndex(s => s.title === currentSeasonFolder.title);
      if (currentSeasonIndex < seriesRoot.children.length - 1) {
        btnText.innerText = "SAISON SUIVANTE";
        nextBtn.style.display = "flex";
      }
    }
  }

  overlay.style.display = "block";
  document.body.classList.add("no-scroll", "player-open");
  setTimeout(() => overlay.classList.add("active"), 50);
}

function handleNextClick() {
  const currentSeasonFolder = pathStack[pathStack.length - 1];
  const episodes = currentSeasonFolder.children.filter(c => !c.children || c.video);
  const currentIndex = episodes.findIndex(e => e.title === currentPlayingItem.title);

  if (currentIndex < episodes.length - 1) {
    playMedia(episodes[currentIndex + 1]);
  } 
  else {
    const seriesRoot = pathStack[pathStack.length - 2];
    const currentSeasonIndex = seriesRoot.children.findIndex(s => s.title === currentSeasonFolder.title);
    const nextSeasonFolder = seriesRoot.children[currentSeasonIndex + 1];
    pathStack.pop(); 
    openFolder(nextSeasonFolder); 
    const firstEp = nextSeasonFolder.children.find(c => !c.children || c.video);
    if (firstEp) playMedia(firstEp);
  }
}

function closePlayer() {
  const overlay = document.getElementById("player-overlay");
  overlay.classList.remove("active");
  document.body.classList.remove("no-scroll", "player-open");
  setTimeout(() => { document.getElementById("video-engine").src = ""; overlay.style.display = "none"; }, 500);
}

searchInput.addEventListener("input", (e) => {
  const q = e.target.value.toLowerCase();
  clearBtn.style.display = q ? "block" : "none";
  if(!q) return renderInitial();
  grid.innerHTML = "";
  const found = [];
  const search = (list) => list.forEach(item => {
    if(item.active !== false && item.title.toLowerCase().includes(q)) found.push(item);
    if(item.children) search(item.children);
  });
  search([...contentData.folders, ...contentData.films]);
  if(found.length === 0) document.getElementById("no-results").style.display = "flex";
  else {
    document.getElementById("no-results").style.display = "none";
    found.forEach(f => buildItem(f));
    lucide.createIcons();
    grid.querySelectorAll(".content-card").forEach((c, i) => setTimeout(() => c.classList.add("visible"), i * 20));
  }
});
clearBtn.onclick = () => { searchInput.value = ""; renderInitial(); };
</script>
</body>
</html>