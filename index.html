<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Copyflix</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="icon" type="image/png" href="favicon.png">


<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Inter',sans-serif;}
body{background:#0f0f0f;color:white;overflow-x:hidden}

/* HEADER */
header{
  position:fixed;top:0;width:100%;height:70px;z-index:10;
  display:flex;align-items:center;justify-content:space-between;
  padding:0 40px;background:rgba(0,0,0,.6);backdrop-filter:blur(10px);
}
header.scrolled{background:#000}
.logo{font-size:28px;font-weight:800;color:#e50914}
.admin-btn,.search-input{padding:8px 16px;border:none;border-radius:5px}
.admin-btn{background:#e50914;color:white;cursor:pointer}
.search-input{background:#1c1c1c;color:white;outline:none}

/* HERO */
.hero{
  height:45vh;margin-top:70px;
  background:linear-gradient(to bottom,rgba(0,0,0,.5),rgba(0,0,0,.95)),
  url("https://images.unsplash.com/photo-1524985069026-dd778a71c7b4") center/cover no-repeat;
  display:flex;flex-direction:column;justify-content:center;align-items:center;
}
.hero h1{font-size:2rem;margin-bottom:20px}

/* MENU */
.nav-hero{display:flex;gap:25px}
.nav-hero a{color:white;cursor:pointer;position:relative}
.nav-hero a.active{color:#e50914}
.nav-hero a.active::after{
  content:"";position:absolute;bottom:-6px;left:0;width:100%;height:3px;
  background:#e50914;border-radius:3px;
}

/* GRID */
#grid{
  display:flex;flex-wrap:wrap;justify-content:center;
  gap:20px;padding:40px;
  transition:transform .4s ease,opacity .4s ease;
}
.card{
  width:180px;background:#111;border-radius:12px;
  overflow:hidden;cursor:pointer;position:relative;
  transition:.3s;
}
.card img{width:100%;height:270px;object-fit:cover}
.card-title{text-align:center;padding:10px;font-weight:600}

/* DISABLED */
.card.disabled img{filter:grayscale(100%) brightness(.35)}
.card.disabled::after{
  content:"Bientôt disponible";
  position:absolute;
  top:50%;left:50%;
  transform:translate(-50%,-50%) rotate(-45deg);
  font-size:1.3rem;
  font-weight:800;
  letter-spacing:1px;
  pointer-events:none;
  color:white;
  text-shadow:0 0 10px rgba(0,0,0,.8);
  white-space:nowrap;
}

/* BREADCRUMB */
#breadcrumb{
  display:none;
  margin:10px auto;
  padding:6px 14px;
  background:rgba(255,255,255,.1);
  border-radius:12px;
  font-size:.85rem;
  width:fit-content;
}
.breadcrumb-item:not(:last-child)::after{
  content:"›";margin:0 6px;color:#e50914;
}

/* BACK */
#backBtn{
  display:none;
  margin:0 auto 10px;
  padding:6px 14px;
  border-radius:20px;
  background:#e50914;
  cursor:pointer;
  width:fit-content;
}

/* ================= VIDEO POPUP ================= */

#video-overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.85);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:1000;
  opacity:0;
  transition:opacity .3s ease;
}

#video-overlay.show{opacity:1}
#video-overlay.hide{opacity:0}

#video-modal{
  position:relative;
  width:800px;
  height:450px;
  background:black;
  border-radius:12px;
  overflow:hidden;
  transform:scale(.9);
  opacity:0;
  transition:transform .35s ease, opacity .35s ease;
}

#video-modal.show{
  transform:scale(1);
  opacity:1;
}

#video-modal.hide{
  transform:scale(.9);
  opacity:0;
}

#video-modal iframe{width:100%;height:100%;border:none}

#close-video{
  position:absolute;
  top:8px;
  right:12px;
  font-size:22px;
  color:white;
  cursor:pointer;
  z-index:10;
}

@media(max-width:900px){
  #video-modal{width:90vw;height:50vw}
}
</style>
</head>

<body>

<header>
  <div class="logo">COPYFLIX</div>
  <input class="search-input" placeholder="Rechercher...">
  <button class="admin-btn" onclick="window.open('admin/login.html','_blank')">Admin</button>
</header>

<section class="hero">
  <h1>Bienvenue sur Copyflix</h1>
  <nav class="nav-hero">
    <a class="active" onclick="setFilter('all',this)">Accueil</a>
    <a onclick="setFilter('film',this)">Films</a>
    <a onclick="setFilter('serie',this)">Séries</a>
  </nav>
</section>

<div id="breadcrumb"></div>
<div id="backBtn">← Retour</div>
<div id="grid"></div>

<!-- VIDEO -->
<div id="video-overlay">
  <div id="video-modal">
    <i id="close-video" class="fa-solid fa-xmark"></i>
    <iframe id="video-frame" allowfullscreen></iframe>
  </div>
</div>

<script>
let data,currentFilter="all",historyStack=[];
const grid=document.getElementById("grid");
const breadcrumb=document.getElementById("breadcrumb");
const backBtn=document.getElementById("backBtn");
const searchInput=document.querySelector(".search-input");
const overlay=document.getElementById("video-overlay");
const modal=document.getElementById("video-modal");
const iframe=document.getElementById("video-frame");

fetch("data.json").then(r=>r.json()).then(j=>{data=j;renderRoot();});

window.addEventListener("scroll",()=>document.querySelector("header").classList.toggle("scrolled",scrollY>50));

function setFilter(type,el){
  currentFilter=type==="film"?"Film":type==="serie"?"Série":"all";
  document.querySelectorAll(".nav-hero a").forEach(a=>a.classList.remove("active"));
  el.classList.add("active");
  historyStack=[];
  breadcrumb.style.display="none";
  backBtn.style.display="none";
  animate(renderRoot);
}

searchInput.addEventListener("input",()=>animate(renderSearch));

function animate(fn){
  grid.style.opacity=0;
  grid.style.transform="translateX(40px)";
  setTimeout(()=>{fn();grid.style.opacity=1;grid.style.transform="translateX(0)";},150);
}

/* ROOT */
function renderRoot(){
  historyStack=[];
  renderItems(data.folders,data.films);
}

/* SEARCH */
function renderSearch(){
  const q=searchInput.value.toLowerCase();
  if(!q){renderRoot();return;}
  grid.innerHTML="";
  traverse(data.folders);
  data.films.forEach(f=>f.title.toLowerCase().includes(q)&&renderFilm(f));
}

function traverse(folders){
  folders.forEach(f=>{
    if(f.title.toLowerCase().includes(searchInput.value.toLowerCase())) renderFolder(f);
    f.children&&traverse(f.children.filter(c=>c.type==="Folder"));
    f.children&&f.children.filter(c=>c.type!=="Folder").forEach(c=>{
      if(c.title.toLowerCase().includes(searchInput.value.toLowerCase())) renderFilm(c);
    });
  });
}

function renderItems(folders=[],films=[]){
  grid.innerHTML="";
  folders.forEach(f=>{if(currentFilter==="all"||folderHasType(f,currentFilter))renderFolder(f);});
  films.forEach(f=>{if(currentFilter==="all"||f.type===currentFilter)renderFilm(f);});
}

function folderHasType(folder,type){
  return folder.children?.some(c=>c.type===type||c.type==="Folder"&&folderHasType(c,type));
}

function renderFolder(folder){
  const d=document.createElement("div");
  d.className="card"+(folder.active===false?" disabled":"");
  d.innerHTML=`<img src="${folder.image}"><div class="card-title">${folder.title}</div>`;
  d.onclick=()=>folder.active!==false&&enterFolder(folder);
  grid.appendChild(d);
}

function renderFilm(film){
  const d=document.createElement("div");
  d.className="card"+(film.active===false?" disabled":"");
  d.innerHTML=`<img src="${film.image}"><div class="card-title">${film.title}</div>`;
  d.onclick=()=>film.active!==false&&openVideo(film.video);
  grid.appendChild(d);
}

/* NAV */
function enterFolder(folder){
  historyStack.push(folder);
  updateNavigation();
  renderItems(
    folder.children.filter(c=>c.type==="Folder"),
    folder.children.filter(c=>c.type!=="Folder")
  );
}

backBtn.onclick=()=>{
  historyStack.pop();
  if(historyStack.length===0){
    breadcrumb.style.display="none";
    backBtn.style.display="none";
    renderRoot();
  }else{
    const parent=historyStack[historyStack.length-1];
    updateNavigation();
    renderItems(
      parent.children.filter(c=>c.type==="Folder"),
      parent.children.filter(c=>c.type!=="Folder")
    );
  }
};

function updateNavigation(){
  breadcrumb.style.display="flex";
  backBtn.style.display="block";
  breadcrumb.innerHTML=historyStack.map(f=>`<span class="breadcrumb-item">${f.title}</span>`).join("");
}

/* VIDEO ANIMATIONS */
function openVideo(src){
  iframe.src=src;
  overlay.style.display="flex";
  requestAnimationFrame(()=>{
    overlay.classList.add("show");
    modal.classList.add("show");
  });
}

function closeVideo(){
  overlay.classList.remove("show");
  modal.classList.remove("show");
  overlay.classList.add("hide");
  modal.classList.add("hide");

  setTimeout(()=>{
    iframe.src="";
    overlay.style.display="none";
    overlay.classList.remove("hide");
    modal.classList.remove("hide");
  },350);
}

document.getElementById("close-video").onclick=closeVideo;
overlay.onclick=e=>e.target===overlay&&closeVideo();
</script>

</body>
</html>
