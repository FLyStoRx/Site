<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Copyflix</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
<link rel="icon" type="image/png" href="favicon.png">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Inter',sans-serif;}
body{background:#0f0f0f;color:white;}

/* HEADER */
header{
  position:fixed;
  top:0;
  width:100%;
  height:70px;
  z-index:20;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 40px;
  background:rgba(0,0,0,0.6);
  backdrop-filter:blur(10px);
}
header.scrolled{background:#000;}
.logo{font-size:28px;font-weight:800;color:#e50914;}

.header-right{
  display:flex;
  align-items:center;
  gap:15px;
}

.search-input{
  padding:7px 12px;
  border-radius:20px;
  border:none;
  outline:none;
  background:#1a1a1a;
  color:white;
  font-size:0.85rem;
}

.admin-btn{
  padding:8px 16px;
  border:none;
  border-radius:20px;
  background:#e50914;
  color:white;
  cursor:pointer;
  font-weight:600;
}

/* HERO */
.hero{
  height:45vh;
  margin-top:70px;
  background:
    linear-gradient(to bottom,rgba(0,0,0,.5),rgba(0,0,0,.95)),
    url("https://images.unsplash.com/photo-1524985069026-dd778a71c7b4") center/cover no-repeat;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  text-align:center;
  gap:20px;
}

.hero h1{
  font-size:2.2rem;
  font-weight:700;
}

.hero-nav{
  display:flex;
  gap:25px;
}

.hero-nav a{
  cursor:pointer;
  font-weight:600;
  padding:6px 12px;
  border-radius:20px;
  transition:.3s;
}

.hero-nav a.active,
.hero-nav a:hover{
  background:#e50914;
}

/* CONTENT */
#grid{
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  gap:20px;
  padding:40px;
  opacity:1;
  transform:translateY(0);
  transition:opacity .25s ease, transform .25s ease;
}

#grid.fade-out{
  opacity:0;
  transform:translateY(12px);
}

.card{
  background:#111;
  border-radius:12px;
  overflow:hidden;
  width:180px;
  cursor:pointer;
}

.card img{
  width:100%;
  height:270px;
  object-fit:cover;
}

.card-title{
  text-align:center;
  padding:10px;
  font-size:.9rem;
}

.folder{border:2px solid #e50914;}

/* RETOUR */
#backBtn{
  display:none;
  margin:15px auto;
  padding:8px 16px;
  border-radius:20px;
  background:#e50914;
  font-weight:600;
  cursor:pointer;
  width:fit-content;
}

/* BREADCRUMB */
#breadcrumb{
  display:none;
  margin:10px auto;
  padding:6px 12px;
  background:rgba(255,255,255,.1);
  border-radius:12px;
  font-size:.85rem;
}

.breadcrumb-item:not(:last-child)::after{
  content:" › ";
  color:#e50914;
}

/* RESPONSIVE */
@media(max-width:768px){
  .card{width:45%;}
}
@media(max-width:480px){
  .card{width:100%;}
}
</style>
</head>

<body>

<header>
  <div class="logo">COPYFLIX</div>
  <div class="header-right">
    <input class="search-input" placeholder="Rechercher..." oninput="search(this.value)">
    <button class="admin-btn" onclick="window.open('admin/login.html','_blank')">Admin</button>
  </div>
</header>

<section class="hero">
  <h1>Bienvenue sur Copyflix</h1>
  <div class="hero-nav">
    <a id="nav-all" class="active" onclick="setFilter('all')">Accueil</a>
    <a id="nav-film" onclick="setFilter('film')">Films</a>
    <a id="nav-serie" onclick="setFilter('serie')">Séries</a>
  </div>
</section>

<div id="breadcrumb"></div>
<div id="backBtn">← Retour</div>
<div id="grid"></div>

<script>
window.addEventListener("scroll",()=>document.querySelector("header").classList.toggle("scrolled",scrollY>50));

let copyflixData;
fetch("data.json").then(r=>r.json()).then(j=>{copyflixData=j; renderRoot();});

const grid=document.getElementById("grid");
const backBtn=document.getElementById("backBtn");
const breadcrumb=document.getElementById("breadcrumb");
let currentFilter="all";
let historyStack=[];
let searchValue="";

function renderRoot(){
  historyStack=[];
  backBtn.style.display="none";
  breadcrumb.style.display="none";
  renderItems(copyflixData.folders,copyflixData.films);
}

function renderItems(folders=[],films=[]){
  grid.innerHTML="";
  folders.forEach(f=>{
    if((currentFilter==='all'||folderHasType(f,currentFilter)) && f.title.toLowerCase().includes(searchValue))
      renderFolder(f);
  });
  films.forEach(f=>{
    if((currentFilter==='all'||f.type===currentFilter) && f.title.toLowerCase().includes(searchValue))
      renderFilm(f);
  });
}

function folderHasType(folder,type){
  return folder.children?.some(c=>c.type===type||c.type==="Folder"&&folderHasType(c,type));
}

function renderFolder(folder){
  const d=document.createElement("div");
  d.className="card folder";
  d.innerHTML=`<img src="${folder.image}"><div class="card-title">${folder.title}</div>`;
  d.onclick=()=>openFolder(folder);
  grid.appendChild(d);
}

function renderFilm(film){
  const d=document.createElement("div");
  d.className="card";
  d.innerHTML=`<img src="${film.image}"><div class="card-title">${film.title}</div>`;
  d.onclick=()=>window.open(film.video,"_blank");
  grid.appendChild(d);
}

function openFolder(folder){
  historyStack.push(folder);
  backBtn.style.display="block";
  breadcrumb.style.display="block";
  breadcrumb.innerHTML=historyStack.map(f=>`<span class="breadcrumb-item">${f.title}</span>`).join("");
  renderItems(
    folder.children.filter(c=>c.type==="Folder"),
    folder.children.filter(c=>c.type!=="Folder")
  );
}

backBtn.onclick=()=>historyStack.length>1?openFolder(historyStack.pop()):renderRoot();

function setFilter(type){
  document.querySelectorAll(".hero-nav a").forEach(a=>a.classList.remove("active"));
  document.getElementById("nav-"+type)?.classList.add("active");

  grid.classList.add("fade-out");
  setTimeout(()=>{
    currentFilter=type==="film"?"Film":type==="serie"?"Série":"all";
    renderRoot();
    grid.classList.remove("fade-out");
  },150);
}

function search(v){
  searchValue=v.toLowerCase();
  renderRoot();
}
</script>

</body>
</html>
