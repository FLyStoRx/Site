<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Copyflix</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
<link rel="icon" type="image/png" href="favicon.png">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Inter',sans-serif;}
body{background:#0f0f0f;color:white;}
header{position:fixed;top:0;width:100%;height:70px;z-index:10;display:flex;align-items:center;justify-content:space-between;padding:0 40px;background:rgba(0,0,0,0.6);backdrop-filter:blur(10px);}
header.scrolled{background:#000;}
.logo{font-size:28px;font-weight:800;color:#e50914;}
.admin-btn, .search-input{padding:8px 16px;border:none;border-radius:5px;cursor:pointer;}
.admin-btn{background:#e50914;color:white;}
.search-input{background:#1c1c1c;color:white;outline:none;}

/* Hero */
.hero{height:45vh;margin-top:70px;background:linear-gradient(to bottom,rgba(0,0,0,.5),rgba(0,0,0,.95)),url("https://images.unsplash.com/photo-1524985069026-dd778a71c7b4") center/cover no-repeat;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;position:relative;}
.hero h1{font-size:2rem;position:relative;animation:fadeIn 1s ease-in-out;margin-bottom:20px;}
@keyframes fadeIn{0%{opacity:0; transform:translateY(-20px);}100%{opacity:1; transform:translateY(0);}}

/* Menu sous hero */
.nav-hero{display:flex;justify-content:center;gap:25px;margin-bottom:0;}
.nav-hero a{color:white;text-decoration:none;cursor:pointer;position:relative;padding:5px 0;}
.nav-hero a.active::after{content:"";position:absolute;bottom:-5px;left:0;width:100%;height:3px;background:#e50914;border-radius:2px;transition:0.3s;}
.nav-hero a.active{color:#e50914;}

/* Grille */
#grid{display:flex;flex-wrap:wrap;justify-content:center;gap:20px;padding:40px;transition: transform 0.5s ease, opacity 0.5s ease;}
.card{background:#111;border-radius:12px;overflow:hidden;width:180px;cursor:pointer;transition:transform 0.3s,box-shadow 0.3s;position:relative;}
.card img{width:100%;height:270px;object-fit:cover;display:block;}
.card-title{text-align:center;padding:10px;font-weight:600;} /* TITRE SOUS L'IMAGE */

/* Désactivé style Netflix */
.card.disabled img{filter:grayscale(100%) brightness(0.5);}
.card.disabled::after{
  content:"Bientôt disponible";
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%) rotate(-45deg);
  color:white;
  font-weight:700;
  font-size:1.2rem;
  text-align:center;
  pointer-events:none;
  letter-spacing:1px;
  white-space:nowrap;
}

/* BOUTON RETOUR */
#backBtn{
  display:none;
  margin:0 auto 15px auto;
  padding:8px 15px;
  font-weight:600;
  cursor:pointer;
  user-select:none;
  border-radius:20px;
  background:rgba(229,9,20,0.9);
  color:white;
  font-size:0.9rem;
  max-width:200px;
  text-align:center;
  transition:0.3s;
}
#backBtn:hover{background:rgba(229,9,20,1);}

/* BREADCRUMB */
#breadcrumb{
  display:flex;
  flex-wrap:wrap;
  align-items:center;
  gap:5px;
  margin:0 auto 15px auto;
  padding:5px 10px;
  font-size:0.85rem;
  border-radius:12px;
  background:rgba(255,255,255,0.1);
  max-width:fit-content;
}
.breadcrumb-item{color:#fff;}
.breadcrumb-item:not(:last-child)::after{content:'›';margin:0 5px;color:#e50914;}

/* RESPONSIVE MOBILE */
@media (max-width: 768px) {
  header { padding: 0 20px; height: 60px; }
  .logo { font-size: 24px; }
  .hero { height: 35vh; padding: 0 10px; }
  #grid { gap: 15px; padding: 20px; }
  .card { width: 45%; }
  .card img { height:220px; }
  #backBtn { margin: 10px auto; font-size: 0.85rem; padding: 6px 12px; }
  #breadcrumb { margin: 10px auto 15px auto; padding: 4px 8px; gap:4px; }
  .breadcrumb-item { font-size:0.75rem; padding: 2px 4px; }
}
@media (max-width: 480px) {
  .card { width: 100%; }
  .card img { height: 200px; }
  header { flex-direction: column; height: auto; padding: 10px 15px; }
}
</style>
</head>

<body>

<header>
  <div class="logo">COPYFLIX</div>
  <input class="search-input" type="text" placeholder="Rechercher...">
  <button class="admin-btn" onclick="window.open('admin/login.html','_blank')">Admin</button>
</header>

<section class="hero">
  <h1>Bienvenue sur Copyflix</h1>
  <nav class="nav-hero">
    <a class="active" onclick="setFilter('all')">Accueil</a>
    <a onclick="setFilter('film')">Films</a>
    <a onclick="setFilter('serie')">Séries</a>
  </nav>
</section>

<section id="content">
  <div id="breadcrumb"></div>
  <div id="backBtn">← Retour</div>
  <div id="grid"></div>
</section>

<script>
let copyflixData;
fetch("data.json").then(r=>r.json()).then(j=>{copyflixData=j; renderRoot();});

const grid = document.getElementById("grid");
const backBtn = document.getElementById("backBtn");
const breadcrumb = document.getElementById("breadcrumb");
const searchInput = document.querySelector(".search-input");
let currentFilter = "all";
let historyStack = [];

window.addEventListener("scroll",()=>document.querySelector("header").classList.toggle("scrolled",scrollY>50));

function setFilter(type){
  if(type==="film") currentFilter="Film";
  else if(type==="serie") currentFilter="Série";
  else currentFilter="all";

  document.querySelectorAll(".nav-hero a").forEach(a=>a.classList.remove("active"));
  if(type==="all") document.querySelector(".nav-hero a:first-child").classList.add("active");
  if(type==="film") document.querySelector(".nav-hero a:nth-child(2)").classList.add("active");
  if(type==="serie") document.querySelector(".nav-hero a:nth-child(3)").classList.add("active");

  // Effet slide
  grid.style.opacity = 0;
  grid.style.transform = "translateX(50px)";
  setTimeout(()=>{ renderRoot(); grid.style.opacity=1; grid.style.transform="translateX(0)"; }, 150);
}

searchInput.addEventListener("input",()=>renderRoot());

function renderRoot(){
  historyStack=[];
  backBtn.style.display="none";
  renderBreadcrumb();
  renderItems(copyflixData.folders, copyflixData.films);
}

function renderItems(folders=[], films=[]){
  grid.innerHTML="";
  const query = searchInput.value.toLowerCase();
  folders.forEach(f=>{ if(currentFilter==='all' || folderHasType(f,currentFilter)) renderFolder(f,query); });
  films.forEach(f=>{
    if((currentFilter==='all' || f.type===currentFilter) && f.title.toLowerCase().includes(query)) renderFilm(f);
  });
}

function folderHasType(folder, type){
  if(!folder.children) return false;
  return folder.children.some(c=>{
    if(c.type===type) return true;
    if(c.type==="Folder") return folderHasType(c,type);
    return false;
  });
}

function renderFolder(folder, query=""){
  const d=document.createElement("div");
  d.className="card folder"+(folder.active===false?" disabled":"");
  d.innerHTML=`<img src="${folder.image}"><div class="card-title">${folder.title}</div>`;
  d.onclick=()=>{if(folder.active!==false) openFolder(folder);};
  if(folder.title.toLowerCase().includes(query) || folder.children.some(c=>c.title.toLowerCase().includes(query)) || query==="") grid.appendChild(d);
}

function renderFilm(film){
  const d=document.createElement("div");
  d.className="card"+(film.active===false?" disabled":"");
  d.innerHTML=`<img src="${film.image}"><div class="card-title">${film.title}</div>`;
  d.onclick=()=>{if(film.active!==false) window.open(film.video,"_blank");};
  grid.appendChild(d);
}

function openFolder(folder){
  historyStack.push(folder);
  backBtn.style.display="block";
  renderBreadcrumb();
  renderItems(
    folder.children.filter(c=>c.type==="Folder"),
    folder.children.filter(c=>c.type!=="Folder")
  );
}

backBtn.onclick=()=>{
  historyStack.pop();
  if(historyStack.length===0) renderRoot();
  else{
    const parent=historyStack[historyStack.length-1];
    renderBreadcrumb();
    renderItems(
      parent.children.filter(c=>c.type==="Folder"),
      parent.children.filter(c=>c.type!=="Folder")
    );
  }
};

function renderBreadcrumb(){
  breadcrumb.innerHTML="";
  historyStack.forEach(f=>{
    const span=document.createElement("span");
    span.className="breadcrumb-item";
    span.textContent=f.title;
    breadcrumb.appendChild(span);
  });
  breadcrumb.style.display = historyStack.length ? "flex" : "none";
}
</script>

</body>
</html>
