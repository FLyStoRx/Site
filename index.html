<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Copyflix</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
<link rel="icon" type="image/png" href="favicon.png">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Inter',sans-serif;}
body{background:#0f0f0f;color:white;}
header{position:fixed;top:0;width:100%;height:70px;z-index:10;display:flex;align-items:center;justify-content:space-between;padding:0 40px;background:rgba(0,0,0,0.6);backdrop-filter:blur(10px);}
header.scrolled{background:#000;}
.logo{font-size:28px;font-weight:800;color:#e50914;}
nav{display:flex;gap:25px;}
nav a{color:white;text-decoration:none;cursor:pointer;}
.admin-btn{padding:8px 16px;border:none;border-radius:5px;background:#e50914;color:white;cursor:pointer;}
.hero{height:45vh;margin-top:70px;background:linear-gradient(to bottom,rgba(0,0,0,.5),rgba(0,0,0,.95)),url("https://images.unsplash.com/photo-1524985069026-dd778a71c7b4") center/cover no-repeat;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;}
.hero h1{font-size:2rem;}
#grid{display:flex;flex-wrap:wrap;justify-content:center;gap:20px;padding:40px;}
.card{background:#111;border-radius:12px;overflow:hidden;width:180px;cursor:pointer;transition:transform 0.3s,box-shadow 0.3s;}
.card img{width:100%;height:270px;object-fit:cover;}
.card-title{text-align:center;padding:10px;}
.folder{border:2px solid #e50914;}

/* BOUTON RETOUR MODERNE */
#backBtn{
  display:none;
  margin:0 auto 15px auto;
  padding:8px 15px;
  font-weight:600;
  cursor:pointer;
  user-select:none;
  border-radius:20px;
  background:rgba(229,9,20,0.9);
  color:white;
  font-size:0.9rem;
  max-width:200px;
  text-align:center;
  transition:0.3s;
}
#backBtn:hover{background:rgba(229,9,20,1);}

/* BREADCRUMB */
#breadcrumb{
  display:flex;
  flex-wrap:wrap;
  align-items:center;
  gap:5px;
  margin:0 auto 15px auto;
  padding:5px 10px;
  font-size:0.85rem;
  border-radius:12px;
  background:rgba(255,255,255,0.1);
  max-width:fit-content;
}
.breadcrumb-item{color:#fff;}
.breadcrumb-item:not(:last-child)::after{content:'›';margin:0 5px;color:#e50914;}

/* RESPONSIVE MOBILE */
@media (max-width: 768px) {
  header { padding: 0 20px; height: 60px; }
  .logo { font-size: 24px; }
  nav { gap: 15px; }
  .hero { height: 35vh; padding: 0 10px; }
  #grid { gap: 15px; padding: 20px; }
  .card { width: 45%; }
  .card img { height: 220px; }
  #backBtn { margin: 10px auto; font-size: 0.85rem; padding: 6px 12px; }
  #breadcrumb { margin: 10px auto 15px auto; padding: 4px 8px; gap:4px; }
  .breadcrumb-item { font-size:0.75rem; padding: 2px 4px; }
}
@media (max-width: 480px) {
  .card { width: 100%; }
  .card img { height: 200px; }
  nav { flex-wrap: wrap; }
  header { flex-direction: column; height: auto; padding: 10px 15px; }
  .hero h1 { font-size: 1.5rem; padding:0 10px; }
}
</style>
</head>

<body>

<header>
  <div class="logo">COPYFLIX</div>
  <nav>
    <a onclick="setFilter('all')">Accueil</a>
    <a onclick="setFilter('film')">Films</a>
    <a onclick="setFilter('serie')">Séries</a>
  </nav>
  <button class="admin-btn" onclick="window.open('admin/login.html','_blank')">Admin</button>
</header>

<section class="hero">
  <h1>Bienvenue sur Copyflix</h1>
</section>

<section id="content">
  <div id="breadcrumb"></div>
  <div id="backBtn">← Retour</div>
  <div id="grid"></div>
</section>

<script>
// HEADER SCROLL
window.addEventListener("scroll",()=>document.querySelector("header").classList.toggle("scrolled",scrollY>50));

// ----- DATA -----
let copyflixData;
fetch("data.json").then(r=>r.json()).then(j=>{copyflixData=j; renderRoot();});

// ----- VARIABLES -----
const grid = document.getElementById("grid");
const backBtn = document.getElementById("backBtn");
const breadcrumb = document.getElementById("breadcrumb");
let currentFilter = "all";
let historyStack = [];

// ----- INIT -----
function renderRoot(){
  historyStack=[];
  backBtn.style.display="none";
  renderBreadcrumb();
  renderItems(copyflixData.folders, copyflixData.films);
}

// ----- RENDER ITEMS -----
function renderItems(folders=[], films=[]){
  grid.innerHTML="";
  folders.forEach(f=>{ if(currentFilter==='all' || folderHasType(f,currentFilter)) renderFolder(f); });
  films.forEach(f=>{ if(currentFilter==='all' || f.type===currentFilter) renderFilm(f); });
}

// ----- CHECK RECURSIVE -----
function folderHasType(folder, type){
  if(!folder.children) return false;
  return folder.children.some(c=>{
    if(c.type===type) return true;
    if(c.type==="Folder") return folderHasType(c,type);
    return false;
  });
}

// ----- CARDS -----
function renderFolder(folder){
  const d=document.createElement("div");
  d.className="card folder";
  d.innerHTML=`<img src="${folder.image}"><div class="card-title">${folder.title}</div>`;
  d.onclick=()=>openFolder(folder);
  grid.appendChild(d);
}

function renderFilm(film){
  const d=document.createElement("div");
  d.className="card";
  d.innerHTML=`<img src="${film.image}"><div class="card-title">${film.title}</div>`;
  d.onclick=()=>window.open(film.video,"_blank");
  grid.appendChild(d);
}

// ----- NAVIGATION DOSSIERS -----
function openFolder(folder){
  historyStack.push(folder);
  backBtn.style.display="block";
  renderBreadcrumb();
  renderItems(
    folder.children.filter(c=>c.type==="Folder"),
    folder.children.filter(c=>c.type!=="Folder")
  );
}

// ----- BOUTON RETOUR -----
backBtn.onclick=()=>{
  historyStack.pop();
  if(historyStack.length===0) renderRoot();
  else{
    const parent=historyStack[historyStack.length-1];
    renderBreadcrumb();
    renderItems(
      parent.children.filter(c=>c.type==="Folder"),
      parent.children.filter(c=>c.type!=="Folder")
    );
  }
};

// ----- FILTRES -----
function setFilter(type){
  if(type==="film") currentFilter="Film";
  else if(type==="serie") currentFilter="Série";
  else currentFilter="all";
  renderRoot();
}

// ----- BREADCRUMB -----
function renderBreadcrumb(){
  breadcrumb.innerHTML="";
  historyStack.forEach(f=>{
    const span=document.createElement("span");
    span.className="breadcrumb-item";
    span.textContent=f.title;
    breadcrumb.appendChild(span);
  });
  breadcrumb.style.display = historyStack.length ? "flex" : "none";
}
</script>

</body>
</html>
