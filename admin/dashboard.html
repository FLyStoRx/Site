<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Admin Copyflix</title>
<style>
body { font-family: 'Inter', sans-serif; background: #0d0d0d; color: #fff; margin:0; padding:0; }
h1 { text-align:center; padding:20px 0; font-size:2rem; }
.top-buttons { text-align:center; margin-bottom:20px; }
.top-buttons button { background:#e50914; border:none; color:#fff; padding:10px 16px; margin:0 5px; cursor:pointer; border-radius:8px; font-weight:bold; transition:0.3s; }
.top-buttons button:hover { background:#f6121d; }
#tree-view { max-width:900px; margin:0 auto 50px auto; background:#1c1c1c; padding:20px; border-radius:12px; box-shadow:0 4px 15px rgba(0,0,0,0.5); }
.tree-item { display:flex; justify-content:space-between; align-items:center; padding:8px 12px; margin:5px 0; background:#2a2a2a; border-radius:6px; }
.tree-item:hover { background:#3a3a3a; }
.tree-buttons button { background:#ff4b3e; padding:4px 8px; font-size:0.85rem; border-radius:4px; margin-left:5px; transition:0.2s; }
.tree-buttons button:hover { background:#ff6f61; }
#panel { display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:#1c1c1c; padding:30px 25px; border-radius:12px; box-shadow:0 8px 25px rgba(0,0,0,0.7); z-index:1000; width:350px; }
#panel h2 { margin-top:0; margin-bottom:20px; text-align:center; font-size:1.5rem; }
#panel form label { display:block; margin-bottom:6px; font-weight:bold; }
#panel form input, #panel form select { width:100%; padding:10px; margin-bottom:15px; border-radius:6px; border:1px solid #444; background:#2a2a2a; color:#fff; font-size:1rem; }
#panel form button { width:48%; margin:0 1%; padding:10px; border-radius:8px; border:none; background:#e50914; color:#fff; font-weight:bold; cursor:pointer; transition:0.3s; }
#panel form button:hover { background:#f6121d; }
</style>
</head>
<body>

<h1>Admin Copyflix</h1>

<div class="top-buttons">
  <button id="btn-add-folder">Ajouter Dossier</button>
  <button id="btn-add-film">Ajouter Film/S√©rie</button>
</div>

<div id="tree-view"></div>

<div id="panel">
  <h2 id="panel-title"></h2>
  <form id="panel-form">
    <input type="hidden" id="item-id">
    <label>Titre :</label>
    <input type="text" id="item-title" required>

    <div id="type-field">
      <label>Type:</label>
      <select id="item-type">
        <option value="film">Film</option>
        <option value="serie">S√©rie</option>
        <option value="Folder">Dossier</option>
      </select>
    </div>

    <div id="video-field">
      <label>Lien vid√©o :</label>
      <input type="text" id="item-video" placeholder="https://...">
    </div>

    <div id="image-field">
      <label>Image / Jaquette :</label>
      <input type="text" id="item-image" placeholder="https://...">
    </div>

    <label>Dossier parent :</label>
    <select id="item-parent"></select>

    <div style="display:flex; justify-content: space-between;">
      <button type="submit">Valider</button>
      <button type="button" id="btn-close-panel">Fermer</button>
    </div>
  </form>
</div>

<script>
// JSON import√© du site
let copyflixData = {
  folders: [],
  films: []
};

// ----- ELEMENTS -----
const treeView=document.getElementById("tree-view");
const panel=document.getElementById("panel");
const panelTitle=document.getElementById("panel-title");
const form=document.getElementById("panel-form");
const itemId=document.getElementById("item-id");
const itemTitle=document.getElementById("item-title");
const itemType=document.getElementById("item-type");
const itemVideo=document.getElementById("item-video");
const itemImage=document.getElementById("item-image");
const itemParent=document.getElementById("item-parent");
const typeField=document.getElementById("type-field");
const videoField=document.getElementById("video-field");

document.getElementById("btn-add-folder").onclick=()=>openPanel('add','Folder');
document.getElementById("btn-add-film").onclick=()=>openPanel('add','film');
document.getElementById("btn-close-panel").onclick=closePanel;

renderTree();

// --- FONCTIONS ---
function renderTree(){
  treeView.innerHTML="";
  copyflixData.folders.forEach(f=>renderItem(f,0));
  copyflixData.films.forEach(f=>renderItem(f,0));
}

function renderItem(item,level){
  const div=document.createElement("div");
  div.className="tree-item";
  div.style.paddingLeft=(level*20)+"px";
  div.innerHTML=`<span>${item.title} [${item.type}]</span>
  <div class="tree-buttons">
    <button onclick="editItem('${item.id}')">‚úèÔ∏è</button>
    <button onclick="deleteItem('${item.id}')">üóëÔ∏è</button>
  </div>`;
  treeView.appendChild(div);

  // enfants
  if(item.children){
    item.children.forEach(c=>renderItem(c,level+1));
  }
}

function openPanel(mode,type='film',item=null){
  panel.style.display='block';
  panelTitle.textContent=mode==='add'?"Ajouter":"Modifier";
  itemId.value=item?.id||"";
  itemTitle.value=item?.title||"";
  itemType.value=item?.type||type;
  itemVideo.value=item?.video||"";
  itemImage.value=item?.image||"";

  // Afficher type et video selon mode
  typeField.style.display = type==='Folder' ? 'none' : 'block';
  videoField.style.display = (type==='film' || type==='serie') ? 'block' : 'none';

  populateParentOptions();
}

function closePanel(){
  panel.style.display='none';
}

// REMPLIR LES DOSSIERS PARENTS
function populateParentOptions(){
  itemParent.innerHTML='<option value="">Aucun</option>';
  copyflixData.folders.forEach(f=>{
    const opt=document.createElement("option");
    opt.value=f.id;
    opt.textContent=f.title;
    itemParent.appendChild(opt);
  });
}

// --- AJOUT / MODIF ---
form.onsubmit=function(e){
  e.preventDefault();
  const newItem={
    id:itemId.value||'id_'+Date.now(),
    title:itemTitle.value,
    type:itemType.value,
    image:itemImage.value,
    video:itemVideo.value
  };

  const parentId=itemParent.value;
  if(parentId){
    const parent=findItem(parentId,copyflixData);
    parent.children=parent.children||[];
    if(itemId.value){
      // modif
      const idx=parent.children.findIndex(c=>c.id===itemId.value);
      parent.children[idx]=newItem;
    }else parent.children.push(newItem);
  } else {
    if(itemId.value){
      // modif root
      const idx=copyflixData.films.findIndex(f=>f.id===itemId.value);
      if(idx>=0) copyflixData.films[idx]=newItem;
      else{
        const idxF=copyflixData.folders.findIndex(f=>f.id===itemId.value);
        if(idxF>=0) copyflixData.folders[idxF]=newItem;
      }
    } else {
      if(newItem.type==='Folder') copyflixData.folders.push(newItem);
      else copyflixData.films.push(newItem);
    }
  }
  renderTree();
  closePanel();
};

// --- SUPPRESSION ---
function deleteItem(id){
  deleteRecursive(id,copyflixData);
  renderTree();
}

function deleteRecursive(id,obj){
  obj.folders=obj.folders?.filter(f=>f.id!==id);
  obj.films=obj.films?.filter(f=>f.id!==id);
  obj.folders?.forEach(f=>deleteRecursive(id,f));
  obj.films?.forEach(f=>deleteRecursive(id,f));
}

// --- EDIT ---
function editItem(id){
  const item=findItem(id,copyflixData);
  if(item) openPanel('edit',item.type,item);
}

// --- RECHERCHE D'ITEM ---
function findItem(id,obj){
  let all=[...(obj.folders||[]),...(obj.films||[])];
  for(const i of all){
    if(i.id===id) return i;
    if(i.children){
      const c=findItem(id,{folders:i.children,films:[]});
      if(c) return c;
    }
  }
  return null;
}

</script>
</body>
</html>
